<div (click)="cva.markAsTouched(); showDialog(selectTemplate)">
  @if (buttonTemplateRef) {
    <ng-container
      *ngTemplateOutlet="
        buttonTemplateRef;
        context: { $implicit: selectedItem$() }
      "
    ></ng-container>
  } @else {
    <span class="input input-bordered flex items-center justify-between"
      >{{ cva.value || placeHolder }}
      <mix-icon icon="chevron-down"></mix-icon>
    </span>
  }
</div>

<ng-template #selectTemplate>
  <div class="px-4 pb-4 flex flex-col gap-4">
    <div class="bg-base-100 rounded-2xl overflow-hidden">
      <div
        class="pt-2 pb-2 border-b border-base-content/10 text-center whitespace-nowrap overflow-hidden text-ellipsis"
      >
        <div class="p-4">
          {{ placeHolder }}
        </div>

        <input
          [ngModel]="searchText()"
          (ngModelChange)="searchText.set($event)"
          class="input input-ghost w-full"
          type="text"
          placeholder="Type something to search..."
        />
      </div>
      <div
        class="max-h-[400px] h-[60vh] max-h-[400px] overflow-auto p-4 flex flex-col"
      >
        @for (item of filteredItems$(); track $index) {
          @if (optionTemplateRef) {
            <div (click)="temporaryValue = item.value" class="w-full">
              <ng-container
                *ngTemplateOutlet="
                  optionTemplateRef;
                  context: {
                    $implicit: {
                      item: item,
                      isSelected: temporaryValue === item.value,
                    },
                  }
                "
              ></ng-container>
            </div>
          } @else {
            <div
              class="w-full cursor-pointer flex justify-between items-center py-2"
              (click)="temporaryValue = item.value"
              [class.text-primary]="temporaryValue === item.value"
            >
              {{ item.displayName }}

              @if (temporaryValue === item.value) {
                <mix-icon
                  class="float-end text-primary"
                  icon="check"
                ></mix-icon>
              }
            </div>
          }
        }
      </div>

      <div class="w-full h-[1px] border-b border-base-content/10"></div>

      <button
        class="btn btn-lg btn-ghost w-full font-bold text-primary"
        (click)="onConfirm()"
      >
        {{ okLabel || 'common.ok' | transloco }}
      </button>
    </div>

    <button
      class="btn btn-lg w-full rounded-2xl text-error"
      (click)="onCancel()"
    >
      {{ cancelLabel || 'common.cancel' | transloco }}
    </button>
  </div>
</ng-template>
